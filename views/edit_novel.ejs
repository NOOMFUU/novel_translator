<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: <%= novel.title %></title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <script>
        (function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
        })();
    </script>

    <style>
        /* --- üé® Studio Theme Variables --- */
        :root {
            --studio-bg: #f8fafc;
            --panel-bg: #ffffff;
            --border-color: #e2e8f0;
            --text-color: #334155;
            --text-muted: #94a3b8;
            --primary-color: var(--primary);
            --header-height: 56px;
            --input-bg: #f1f5f9;
        }

        [data-theme="dark"] {
            --studio-bg: #0f172a;
            --panel-bg: #1e293b;
            --border-color: #334155;
            --text-color: #e2e8f0;
            --text-muted: #64748b;
            --input-bg: #0f172a;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--studio-bg);
            color: var(--text-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            font-family: 'Sarabun', sans-serif;
        }

        /* --- Header --- */
        .studio-header {
            height: var(--header-height);
            background: var(--panel-bg);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            flex-shrink: 0;
            z-index: 10;
        }

        /* --- Workspace Layout --- */
        .workspace {
            display: flex;
            flex: 1;
            height: calc(100vh - var(--header-height));
            overflow: hidden;
        }

        /* --- Left Sidebar (Cover) --- */
        .sidebar-panel {
            width: 320px;
            background: var(--studio-bg);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow-y: auto;
            align-items: center;
        }

        .cover-preview {
            width: 100%;
            aspect-ratio: 2/3;
            object-fit: cover;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            background: var(--panel-bg);
        }

        /* --- Right Main Content (Form) --- */
        .main-panel {
            flex: 1;
            background: var(--panel-bg);
            overflow-y: auto;
            padding: 40px;
            display: flex;
            justify-content: center;
        }

        .form-container {
            width: 100%;
            max-width: 800px;
        }

        /* --- Form Elements --- */
        .section-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-color);
            display: flex; align-items: center; gap: 8px;
        }

        .form-group { margin-bottom: 20px; }
        .form-label {
            display: block; font-size: 0.9rem; font-weight: 600;
            margin-bottom: 8px; color: var(--text-color);
        }
        .form-input {
            width: 100%;
            padding: 12px 16px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background: var(--input-bg);
            color: var(--text-color);
            font-family: inherit;
            transition: all 0.2s;
            box-sizing: border-box; /* ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç */
        }
        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.1);
        }
        textarea.form-input { resize: vertical; min-height: 120px; line-height: 1.6; }

        /* --- Status Select Style --- */
        .status-select {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            background: var(--panel-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            font-weight: 600;
            text-align: center;
            cursor: pointer;
        }

        /* --- Buttons --- */
        .btn-save {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 24px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            display: flex; align-items: center; gap: 8px;
            transition: filter 0.2s;
        }
        .btn-save:hover { filter: brightness(1.1); }
        
        .tool-btn {
            background: transparent; border: none;
            color: var(--text-color); opacity: 0.7;
            width: 36px; height: 36px; border-radius: 6px;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
        }
        .tool-btn:hover { background: rgba(0,0,0,0.05); opacity: 1; }

        /* --- Mobile --- */
        @media (max-width: 900px) {
            .workspace { flex-direction: column; overflow-y: auto; height: auto; }
            .sidebar-panel { width: 100%; border-right: none; border-bottom: 1px solid var(--border-color); padding: 30px; }
            .cover-preview { max-width: 200px; }
            .main-panel { padding: 20px; }
            body { overflow: auto; height: auto; }
        }
    </style>
</head>
<body>

    <header class="studio-header">
        <div style="display: flex; align-items: center; gap: 15px;">
            <a href="/novel/<%= novel._id %>" class="tool-btn"><i class="fa-solid fa-arrow-left"></i></a>
            <div>
                <span style="font-size: 0.8rem; opacity: 0.6; display: block; line-height: 1;">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                <strong style="font-size: 1rem;"><%= novel.title %></strong>
            </div>
        </div>
        <div style="display: flex; align-items: center; gap: 10px;">
            <button onclick="toggleTheme()" class="tool-btn"><i class="fa-solid fa-circle-half-stroke"></i></button>
            <button onclick="document.getElementById('editForm').submit()" class="btn-save">
                <i class="fa-solid fa-save"></i> <span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span>
            </button>
        </div>
    </header>

    <div class="workspace">
        
        <form id="editForm" action="/novel/<%= novel._id %>?_method=PUT" method="POST" style="display: contents;">
            
            <aside class="sidebar-panel">
                <img id="coverPreview" src="<%= novel.imageUrl || 'https://placehold.co/400x600/png?text=No+Cover' %>" 
                     class="cover-preview" alt="Cover"
                     onerror="this.src='https://placehold.co/400x600/png?text=No+Cover'">
                
                <div style="width: 100%;">
                    <label class="form-label" style="text-align: center;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</label>
                    <select name="status" class="status-select">
                        <option value="On Going" <%= novel.status === 'On Going' ? 'selected' : '' %>>üü¢ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏õ‡∏•</option>
                        <option value="Completed" <%= novel.status === 'Completed' ? 'selected' : '' %>>üèÅ ‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß</option>
                        <option value="Hiatus" <%= novel.status === 'Hiatus' ? 'selected' : '' %>>‚è∏Ô∏è ‡∏´‡∏¢‡∏∏‡∏î‡πÅ‡∏õ‡∏•</option>
                    </select>
                </div>
            </aside>

            <main class="main-panel">
                <div class="form-container">
                    
                    <div class="section-title"><i class="fa-solid fa-circle-info"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏Å</div>
                    
                    <div class="form-group">
                        <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á (‡πÑ‡∏ó‡∏¢)</label>
                        <input type="text" name="title" value="<%= novel.title %>" class="form-input" style="font-size: 1.1rem; font-weight: 600;" required>
                    </div>

                    <div class="d-flex gap-3" style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <div style="flex: 1; min-width: 250px;">
                            <div class="form-group">
                                <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏° (Original)</label>
                                <input type="text" name="originalTitle" value="<%= novel.originalTitle %>" class="form-input">
                            </div>
                        </div>
                        <div style="flex: 1; min-width: 250px;">
                            <div class="form-group">
                                <label class="form-label">‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö</label>
                                <input type="text" name="originalLink" value="<%= novel.originalLink %>" class="form-input" placeholder="https://...">
                            </div>
                        </div>
                    </div>

                    <div class="d-flex gap-3" style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <div style="flex: 1;">
                            <div class="form-group">
                                <label class="form-label">‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á (Author)</label>
                                <input type="text" name="author" value="<%= novel.author %>" class="form-input">
                            </div>
                        </div>
                        <div style="flex: 1;">
                            <div class="form-group">
                                <label class="form-label">‡∏ô‡∏±‡∏Å‡∏ß‡∏≤‡∏î (Artist)</label>
                                <input type="text" name="artist" value="<%= novel.artist %>" class="form-input">
                            </div>
                        </div>
                    </div>

                    <div class="section-title" style="margin-top: 30px;"><i class="fa-solid fa-list"></i> ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</div>

                    <div class="d-flex gap-3" style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <div style="flex: 1;">
                            <div class="form-group">
                                <label class="form-label">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà (Categories)</label>
                                <input list="categoryList" name="categories" value="<%= (novel.categories || []).join(', ') %>" class="form-input" placeholder="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏≠‡∏á">
                                <datalist id="categoryList">
                                    <% if(locals.categories) { %>
                                        <% categories.forEach(cat => { %>
                                            <option value="<%= cat %>">
                                        <% }) %>
                                    <% } %>
                                    <option value="Fantasy"><option value="Action"><option value="Romance"><option value="Drama"><option value="Isekai">
                                </datalist>
                            </div>
                        </div>
                        <div style="flex: 2;">
                            <div class="form-group">
                                <label class="form-label">Tags (‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≥)</label>
                                <input type="text" name="tags" value="<%= novel.tags.join(', ') %>" class="form-input" placeholder="Magic, School Life, Harem">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏õ‡∏Å (Image URL)</label>
                        <input type="text" name="imageUrl" id="imageUrlInput" value="<%= novel.imageUrl %>" class="form-input" placeholder="https://..." oninput="updatePreview()">
                    </div>

                    <div class="form-group">
                        <label class="form-label">‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡πà‡∏≠</label>
                        <textarea name="description" class="form-input"><%= novel.description %></textarea>
                    </div>

                    <div style="height: 50px;"></div>
                </div>
            </main>
        </form>
    </div>

    <script>
        function updatePreview() {
            const url = document.getElementById('imageUrlInput').value;
            const img = document.getElementById('coverPreview');
            if(url.trim()) {
                img.src = url;
            } else {
                img.src = 'https://placehold.co/400x600/png?text=No+Cover';
            }
        }

        function toggleTheme() {
            const current = document.documentElement.getAttribute('data-theme');
            const next = current === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', next);
            localStorage.setItem('theme', next);
        }
    </script>
</body>
</html>