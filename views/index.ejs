<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Novel Library</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header class="main-header">
        <div class="container d-flex justify-between align-center">
            <a href="/" class="logo">
                <i class="fa-solid fa-book-open-reader"></i>
                <span>Novel<span style="font-weight:300; opacity:0.7;">Hub</span></span>
            </a>
            
            <form action="/" method="GET" style="flex: 1; max-width: 400px; margin: 0 20px; position: relative;">
                <input type="text" name="q" placeholder="ค้นหานิยาย..." value="<%= locals.query || '' %>" style="border-radius: 50px; padding-left: 45px; background: rgba(255,255,255,0.5);">
                <i class="fa-solid fa-magnifying-glass" style="position: absolute; left: 18px; top: 50%; transform: translateY(-50%); color: var(--text-muted);"></i>
            </form>

            <div class="d-flex align-center gap-2">
                <button onclick="toggleTheme()" class="btn btn-outline btn-sm" style="border-radius:50%; width:40px; height:40px; padding:0;"><i class="fa-solid fa-moon"></i></button>
                <% if (isAdmin) { %>
                    <a href="/logout" class="btn btn-sm btn-outline" style="color:var(--danger); border-color:var(--danger);">Logout</a>
                <% } else { %>
                    <a href="/login" class="btn btn-sm btn-primary">Login</a>
                <% } %>
            </div>
        </div>
    </header>

    <div class="container" style="padding-top: 40px; padding-bottom: 60px;">
        
        <% if (isAdmin) { %>
        <div class="card" style="border-left: 4px solid var(--primary); display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 20px;">
            <div>
                <h3 style="margin:0;"><i class="fa-solid fa-wand-magic-sparkles"></i> สร้างโปรเจกต์แปลใหม่</h3>
                <p class="text-muted" style="margin:5px 0 0 0; font-size:0.9rem;">เพิ่มนิยายเรื่องใหม่เข้าสู่ระบบของคุณ</p>
            </div>
            <form action="/novels" method="POST" class="d-flex gap-2" style="flex: 1; max-width: 500px;">
                <input type="text" name="title" placeholder="ชื่อนิยาย..." required>
                <button type="submit" class="btn btn-primary" style="white-space: nowrap;">Create</button>
            </form>
        </div>
        <% } %>

        <div class="d-flex justify-between align-center mb-4">
            <h2 style="font-size: 1.8rem; margin: 0; font-weight: 700;">
                <span style="color: var(--primary);">#</span> อัปเดตล่าสุด
            </h2>
        </div>

        <% if (novels.length === 0) { %>
            <div class="card text-center" style="padding: 80px 20px; border: 2px dashed var(--border); background: transparent;">
                <i class="fa-solid fa-box-open" style="font-size: 3em; color: var(--text-muted); margin-bottom: 15px; opacity: 0.5;"></i>
                <p class="text-muted">ยังไม่มีข้อมูลนิยายในระบบ</p>
            </div>
        <% } %>

        <div class="novel-poster-grid">
            <% novels.forEach(novel => { %>
                <a href="/novel/<%= novel._id %>" class="novel-poster-card">
                    <div class="novel-poster-img-wrapper">
                        <% 
                            let statusClass = 'status-ongoing';
                            let statusText = 'ON GOING';
                            if(novel.status === 'Completed') { statusClass = 'status-completed'; statusText = 'END'; }
                            if(novel.status === 'Hiatus') { statusClass = 'status-hiatus'; statusText = 'HIATUS'; }
                        %>
                        <div class="status-badge <%= statusClass %>"><%= statusText %></div>
                        <img src="<%= novel.imageUrl || 'https://via.placeholder.com/300x450?text=NO+IMAGE' %>" class="novel-poster-img" loading="lazy" alt="<%= novel.title %>">
                    </div>
                    
                    <div style="font-weight: 700; font-size: 1.1rem; line-height: 1.4; margin-bottom: 6px; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">
                        <%= novel.title %>
                    </div>
                    
                    <div class="d-flex align-center justify-between text-muted" style="font-size: 0.85rem;">
                        <span><i class="fa-regular fa-eye"></i> <%= (novel.views || 0).toLocaleString() %></span>
                        <span><i class="fa-solid fa-layer-group"></i> นิยายแปล</span>
                    </div>
                </a>
            <% }) %>
        </div>
    </div>

    <script>
        // Theme Logic
        const currentTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', currentTheme);

        function toggleTheme() {
            const current = document.documentElement.getAttribute('data-theme');
            const next = current === 'light' ? 'dark' : (current === 'dark' ? 'sepia' : 'light');
            document.documentElement.setAttribute('data-theme', next);
            localStorage.setItem('theme', next);
        }
    </script>
</body>
</html>