<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Novel Library</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header class="main-header">
        <div class="container d-flex justify-between align-center">
            <a href="/" class="logo">
                <i class="fa-solid fa-book-bookmark"></i>
                <span>Novel<span style="font-weight:300; opacity:0.7;">Hub</span></span>
            </a>
            
            <form action="/" method="GET" style="flex: 1; max-width: 350px; margin: 0 20px; position: relative;" class="d-none-mobile">
                <input type="text" name="q" placeholder="ค้นหานิยาย..." value="<%= locals.query || '' %>" style="border-radius: 50px; padding-left: 45px;">
                <i class="fa-solid fa-magnifying-glass" style="position: absolute; left: 18px; top: 50%; transform: translateY(-50%); color: var(--text-muted);"></i>
            </form>

            <div class="d-flex align-center gap-2">
                <button onclick="toggleTheme()" class="btn btn-outline btn-sm" style="border-radius:50%; width:40px; height:40px; padding:0;"><i class="fa-solid fa-moon"></i></button>
                <% if (isAdmin) { %>
                    <a href="/logout" class="btn btn-sm btn-outline" style="color:var(--danger); border-color:var(--border);">Logout</a>
                <% } else { %>
                    <a href="/login" class="btn btn-sm btn-primary">Login</a>
                <% } %>
            </div>
        </div>
    </header>

    <div class="container" style="padding-top: 30px; padding-bottom: 50px;">
        
        <% if (isAdmin) { %>
        <div class="card" style="border-left: 4px solid var(--primary); display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 20px;">
            <div>
                <h3 style="margin:0;"><i class="fa-solid fa-folder-plus"></i> จัดการนิยาย</h3>
                <p class="text-muted" style="margin:5px 0 0 0; font-size:0.9rem;">เพิ่มเรื่องใหม่เข้าระบบห้องสมุด</p>
            </div>
            <form action="/novels" method="POST" class="d-flex gap-2" style="flex: 1; max-width: 600px;">
                <input type="text" name="title" placeholder="ชื่อนิยายเรื่องใหม่..." required>
                <button type="submit" class="btn btn-primary" style="white-space: nowrap;">สร้าง</button>
            </form>
        </div>
        <% } %>

        <div class="d-flex justify-between align-center mb-4">
            <h2 style="font-size: 1.5rem; margin: 0; border-left: 4px solid var(--accent); padding-left: 15px;">
                อัปเดตล่าสุด
            </h2>
            <span class="text-muted"><%= novels.length %> เรื่อง</span>
        </div>

        <% if (novels.length === 0) { %>
            <div class="card text-center" style="padding: 80px 20px; border: 2px dashed var(--border); background: transparent;">
                <i class="fa-regular fa-face-sad-tear" style="font-size: 3em; color: var(--text-muted); margin-bottom: 15px;"></i>
                <p class="text-muted">ไม่พบข้อมูลนิยาย</p>
            </div>
        <% } %>

        <div class="novel-poster-grid">
            <% novels.forEach(novel => { %>
                <a href="/novel/<%= novel._id %>" class="novel-poster-card">
                    <div class="novel-poster-img-wrapper">
                        <% 
                            let statusClass = 'status-ongoing';
                            let statusText = 'ON GOING';
                            if(novel.status === 'Completed') { statusClass = 'status-completed'; statusText = 'END'; }
                            if(novel.status === 'Hiatus') { statusClass = 'status-hiatus'; statusText = 'HIATUS'; }
                        %>
                        <div class="status-badge <%= statusClass %>"><%= statusText %></div>
                        
                        <img src="<%= novel.imageUrl || 'https://via.placeholder.com/300x450?text=NO+IMAGE' %>" class="novel-poster-img" alt="<%= novel.title %>">
                        
                        <div class="novel-poster-overlay"></div>
                    </div>
                    
                    <div class="novel-poster-title" title="<%= novel.title %>">
                        <%= novel.title %>
                    </div>
                    <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 4px;">
                        <i class="fa-regular fa-eye"></i> <%= (novel.views || 0).toLocaleString() %>
                    </div>
                </a>
            <% }) %>
        </div>
    </div>

    <script>
        document.documentElement.setAttribute('data-theme', localStorage.getItem('theme') || 'light');
        function toggleTheme() {
            const next = document.documentElement.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', next);
            localStorage.setItem('theme', next);
        }
    </script>
</body>
</html>